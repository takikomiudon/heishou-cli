#!/bin/bash
set -e
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do
  DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
  SOURCE="$(readlink "$SOURCE")"
  case "$SOURCE" in
    /*) ;;
    *) SOURCE="$DIR/$SOURCE" ;;
  esac
done
SCRIPT_DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
unset TMUX_TMPDIR

case "$1" in
  attach)
    shift
    exec tmux attach -t heishou "$@"
    ;;
  kill)
    shift
    tmux kill-session -t heishou || true
    exit 0
    ;;
  ls)
    shift
    exec tmux ls "$@"
    ;;
  *)
    "${SCRIPT_DIR}/heishou_departure.sh" "$@"
    exec tmux attach -t heishou
    ;;
esac
